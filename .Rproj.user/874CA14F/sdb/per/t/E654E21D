{
    "collab_server" : "",
    "contents" : "---\ntitle: 'Results: Systematic review of how we measure functional diversity (FD)'\nauthor: \"Marissa Lee\"\ndate: \"July 29, 2015\"\noutput: \n  pdf_document: \n    number_sections: yes\n    toc: yes\n    toc_depth: 4\n---\n\n\n\n\nSet up the markdown cache, set your working directory, and load the libraries. \n```{r setup,echo=FALSE, warning=FALSE, message=FALSE}\n#set markdown cache so that it doesn't take forever to build the final pdf\nknitr::opts_chunk$set(cache=TRUE)\n\n#set working directory\n#setwd(\"~/Desktop/wd_functionalDiv\")\n\n#load libraries\nlibrary(splitstackshape) #for cSplit()\nlibrary(plyr) \nlibrary(doBy)\nlibrary(ggplot2)\n\n#To cite R and packages...\n# citation()\n# if(nchar(system.file(package=\"splitstackshape\"))) citation(\"splitstackshape\")\n# if(nchar(system.file(package=\"plyr\"))) citation(\"plyr\")\n# if(nchar(system.file(package=\"doBy\"))) citation(\"doBy\")\n# if(nchar(system.file(package=\"ggplot2\"))) citation(\"ggplot2\")\n\n#load custom functions\nsource(\"code/fxn_ExpandMelt.R\")\n```\nRead-in data\n```{r readin,echo=FALSE}\n#read data\nStudy.Info.1<-read.delim(\"cleanData/StudyInfo1.txt\", sep=\"\\t\", header = TRUE)\nTrait.Info.1<-read.delim(\"cleanData/TraitInfo1.txt\", sep=\"\\t\", header = TRUE)\nMetric.Info.1<-read.delim(\"cleanData/MetricInfo1.txt\", sep=\"\\t\", header = TRUE)\n\n#load theme\nsource(\"code/mytheme.R\")\n```\n\n\n# Basic information about the dataset\n```{r basic, echo=FALSE, warning=FALSE}\n#how many studies?\ntotalNumStudies<-length(unique(Study.Info.1$ID))\n\n#does this match across our datasets?\ntotalNumStudies\nlength(unique(Trait.Info.1$ID)) \nlength(unique(Metric.Info.1$ID)) \n\n#how many of those studies were published in 2014, the most recent year included in this dataset?\nsumm.SI.yr <- ddply(Study.Info.1,~year, summarise, nID=length(unique(ID))) \nnumStudies2014<-summ.SI.yr[summ.SI.yr$year==2014,'nID']\nperc_2014<-round((numStudies2014/totalNumStudies)*100, digits=2)\n```  \nThere are `r totalNumStudies` accepted studies in the dataset. In the most recent year, 2014, `r numStudies2014` were published, which is `r perc_2014` % of the total dataset.  \n\n\n\n# What types of locations, ecosystems, and taxa have been the focus of FD calculations?\n\n## Countries\nThe top 5 countries that produce these FD studies are, in decreasing order,\n```{r Q1_countries,echo=FALSE, warning=FALSE}\ndf.iso<-ExpandMelt(df=Study.Info.1, varName='region.ISO3')\nsumm.SI.iso <- ddply(df.iso,~region.ISO3, summarise, nID=length(unique(ID))) \nsumm.SI.iso.o<-orderBy(~-nID, summ.SI.iso)\nsumm.SI.iso.o1<-summ.SI.iso.o[1:5,] #take only the top 10 countries\npositions<-summ.SI.iso.o1$region.ISO3\nPlot.iso<-ggplot(summ.SI.iso.o1, aes(x=region.ISO3, y=nID)) + \n  geom_bar(stat='identity') + \n  ylab('Count') + xlab('Top 10 Countries') +\n  scale_y_continuous(expand=c(0,0)) + scale_x_discrete(limits=positions) + \n  theme_bw() +\n  theme(axis.text.x = element_text(angle=45, hjust=1))\nPlot.iso\npositions\n```  \n`r positions`.\n\n## Terrestrial/Aquatic\n```{r Q1_sys1,echo=FALSE, warning=FALSE}\n#sys1\ndf.sys1<-ExpandMelt(df=Study.Info.1, varName='sys1')\nsumm.SI.sys1 <- ddply(df.sys1,~ID, summarise, \n              presenceA=sum(sys1=='A'),\n              presenceT=sum(sys1=='T')) \nstudiesWithA<-sum(summ.SI.sys1$presenceA==1)\nstudiesWithT<-sum(summ.SI.sys1$presenceT==1)\ntotalNumStudies<-length(summ.SI.sys1$ID)\nstudiesWithBoth<-sum(summ.SI.sys1$presenceA==1 & summ.SI.sys1$presenceT==1)\nperc_terrestrial<-round((studiesWithT/totalNumStudies)*100, digits=2)\npaste(perc_terrestrial, \"% of studies are terrestrial\")\n\n#terrestrial plants?\nsumm.SI.sys1Grp <- ddply(Study.Info.1,~sys1Grp, summarise, nID=length(unique(ID))) \n\nstudiesWithTrPl<-summ.SI.sys1Grp[summ.SI.sys1Grp$sys1Grp=='terrestrial plants','nID']\nperc_TrPl<-round((studiesWithTrPl/totalNumStudies)*100, digits=2)\n#paste(perc_TrPl, \"% of studies are terrestrial plants\")\nPlot.numStudies.sys1Grp<-ggplot(summ.SI.sys1Grp, aes(x=sys1Grp, y=nID, fill=sys1Grp)) + \n  geom_bar(stat='identity') + ylab(\"Number of studies\") +\n  theme_bw() + theme(axis.text.x = element_text(angle=45, hjust=1)) +\n  scale_fill_manual(name='System and Taxa',\n                    labels=sys1Grp_labels,\n                    values=sys1Grp_colors) +\n  guides(fill=FALSE)\nPlot.numStudies.sys1Grp\n\nsumm.SI.sys1Grp\nperc_TrPl\n```  \nThe majority of studies include terrestial systems, which make up `r perc_terrestrial` %.  Of the studies that look at terrestrial systems, `r studiesWithTrPl` studies or `r perc_TrPl`% of the full dataset specifically measure the FD of terrestrial plants.\n\nThe number of studies published on FD has dramatically increased over time and, in the past few years, more studies have focused on aquatic systems and have included multiple systems/taxa (other). *Are there really no aquatic studies in our dataset before 2009???*   \n```{r Q1_sys1Grp_time, echo=FALSE, warning=FALSE}\nsumm.SI.yr.sys1Grp<-ddply(Study.Info.1,~year, summarize,\n      AqAn = sum(sys1Grp=='aquatic animals'),\n      AqPl = sum(sys1Grp=='aquatic plants'),\n      TrAn = sum(sys1Grp=='terrestrial animals'),\n      TrPl = sum(sys1Grp=='terrestrial plants'),\n      Other = sum(!sys1Grp %in% c('aquatic animals','aquatic plants','terrestrial animals','terrestrial plants')))\nsumm.SI.yr.sys1Grp.long<- melt(summ.SI.yr.sys1Grp, id='year') \nsumm.SI.yr.sys1Grp.long$variable<-factor(summ.SI.yr.sys1Grp.long$variable, levels=c('TrPl','TrAn','AqPl','AqAn','Other'))\nPlot.numStudies.sys1Grp.yr<-ggplot(summ.SI.yr.sys1Grp.long, aes(x=year, y=value, fill=variable)) + \n  geom_bar(stat='identity') + \n  ylab('Number of studies') + xlab('Year') +\n  scale_y_continuous(expand=c(0,0), limits=c(0,100)) + \n  scale_x_continuous(breaks=seq(1990, 2014, by=2)) +\n  theme_bw() + theme(axis.text.x = element_text(angle=45, hjust=1)) +\n  scale_fill_manual(name='System and Taxa',\n                    labels=sys1Grp_labels,\n                    values=sys1Grp_colors)\nPlot.numStudies.sys1Grp.yr\n``` \n\n## Habitat\nGrasslands are the most commonly-studied habitats and are included in\n```{r Q1_habitat, echo=FALSE, warning=FALSE, include=FALSE}\n\n### look at strictly 'habitat' ###\n\ndf.habitat<-ExpandMelt(df=Study.Info.1, varName='habitat')\n#unique(df.habitat$habitat)\nsumm.SI.hab <- ddply(df.habitat,~ID, summarise, \n              TAIG=sum(habitat=='TAIG'),\n              TROP=sum(habitat=='TROP'),\n              TEMP=sum(habitat=='TEMP'),\n              GRAS=sum(habitat=='GRAS'),\n              RIPA=sum(habitat=='RIPA'),\n              NEAR=sum(habitat=='NEAR'),\n              AGRI=sum(habitat=='AGRI'),\n              LAKE=sum(habitat=='LAKE'),\n              TUND=sum(habitat=='TUND'),\n              PELA=sum(habitat=='PELA'),\n              DESE=sum(habitat=='DESE'))\nnumStudiesPresent<-apply(summ.SI.hab, 2, sum)[-1]\nhabitatName<-names(numStudiesPresent)\n#habitatName\n#habitat_labels\n\nsumm.SI.habitat<-data.frame(habitatName, numStudiesPresent, habitat_labels)\n\n#define sys1 manually for each habitat\nsys1.manual_levels<-c('Terrestrial','Aquatic')\n#aquaticEco\nsumm.SI.habitat$sys1.manual<-'Terrestrial'\nsumm.SI.habitat[summ.SI.habitat$habitat_labels %in% aquaticEco,'sys1.manual']<-'Aquatic'\nsumm.SI.habitat$sys1.manual<-factor(summ.SI.habitat$sys1.manual, levels=sys1.manual_levels)\nsumm.SI.habitat.o<-orderBy(~sys1.manual-numStudiesPresent, summ.SI.habitat)\n\n#plot\npositions<-summ.SI.habitat.o$habitat_labels\nPlot.habitat.sys1<-ggplot(summ.SI.habitat.o, aes(x=habitat_labels, y=numStudiesPresent, fill=sys1.manual)) + \n  geom_bar(stat='identity') + \n  ylab('# of studies') + xlab('Ecosystem') +\n  scale_y_continuous(expand=c(0,0), limits=c(0,40)) + \n  scale_x_discrete(limits= positions) + \n  theme_bw() + theme(axis.text.x = element_text(angle=45, hjust=1)) +\n  scale_fill_manual(name='System',\n                    label=c('Terrestrial','Aquatic'),\n                    values=c('#008000','#1F497D'))\nPlot.habitat.sys1\n\n\n### look at habitat x sys1Grp ###\n#quick index of sys1Grp by ID\nid_sys1Grp<-data.frame(ID=Study.Info.1$ID, sys1Grp=Study.Info.1$sys1Grp)\nsumm.SI.hab1<-merge(summ.SI.hab, id_sys1Grp, by=\"ID\")\nsumm.SI.hab1.sys1Grp<-ddply(summ.SI.hab1,~sys1Grp, summarize,\n                    TAIG=sum(TAIG==1),\n                    TROP=sum(TROP==1),\n                    TEMP=sum(TEMP==1),\n                    GRAS=sum(GRAS==1),\n                    RIPA=sum(RIPA==1),\n                    NEAR=sum(NEAR==1),\n                    AGRI=sum(AGRI==1),\n                    LAKE=sum(LAKE==1),\n                    TUND=sum(TUND==1),\n                    PELA=sum(PELA==1),\n                    DESE=sum(DESE==1))\nsumm.SI.hab1.sys1Grp.long<- melt(summ.SI.hab1.sys1Grp, id=c('sys1Grp'))\nsetnames(summ.SI.hab1.sys1Grp.long, 'variable', 'habCode')\nhabCode<-summ.SI.habitat.o$habitatName\nhabName<-summ.SI.habitat.o$habitat_labels\nhabindex<-data.frame(habCode, habName)\nsumm.SI.hab1.sys1Grp.long1<-merge(summ.SI.hab1.sys1Grp.long, habindex)\n\n#plot\nPlot.habitat.sys1Grp<-ggplot(summ.SI.hab1.sys1Grp.long1, aes(x=habName, y=value, fill=sys1Grp)) + \n  geom_bar(stat='identity') + \n  scale_y_continuous(expand=c(0,0), limits=c(0,40)) + \n  ylab('# of studies') + xlab('Ecosystem') + scale_x_discrete(limits= positions) + \n  theme_bw() + theme(axis.text.x = element_text(angle=45, hjust=1)) +\n  scale_fill_manual(name='System and Taxa',\n                    labels=c('Terrestrial plants','Terrestrial animals',\n                             'Aquatic plants','Aquatic animals','Other'),\n                    values=c('#008000','#329932',\n                             '#1F497D','#4b6d97','#D72027'))\n\nPlot.habitat.sys1Grp\n\n#percent of studies that include grasslands?\nperc_grassland<-round((summ.SI.habitat[summ.SI.habitat$habitatName=='GRAS','numStudiesPresent']/totalNumStudies)*100, digits=2)\n#paste(perc_grassland, \"% of studies are in grasslands\")\n```\n`r perc_grassland` % of studies in our dataset. For aquatic systems, coastal regions are studied most frequently.  Check out the imbedded code chunk for more detail.\n\n\n## Taxa\nNot surprisingly, plants are the most highly-studied type of organism.\n```{r Q1_taxa,echo=FALSE, warning=FALSE, message=FALSE}\ndf.subgroup<-ExpandMelt(df=Study.Info.1, varName='sub.group')\n#unique(df.subgroup$sub.group)\n#unique(df.subgroup$sys1)        \nsumm.SI.subgroup <- ddply(df.subgroup,~sys1+ID, summarise, \n              shrubs=sum(sub.group=='shrubs'),\n              invertebrates=sum(sub.group=='invertebrates'),\n              vertebrates=sum(sub.group=='vertebrates'),\n              trees=sum(sub.group=='trees'),\n              graminoids=sum(sub.group=='graminoids'),\n              forbs=sum(sub.group=='forbs'),\n              algae=sum(sub.group=='algae'),\n              nonvascular=sum(sub.group=='nonvascular'),\n              fungi=sum(sub.group=='fungi'),\n              diatoms=sum(sub.group=='diatoms'),\n              microbemix=sum(sub.group=='microbemix'))\nsumm.SI.subgroup2<-ddply(summ.SI.subgroup, ~sys1, summarize,\n             Nshrubs=sum(shrubs==1),\n             Ninvertebrates=sum(invertebrates==1),\n             Nvertebrates=sum(vertebrates==1),\n             Ntrees=sum(trees==1),\n             Ngraminoids=sum(graminoids==1),\n             Nforbs=sum(forbs==1),\n             Nalgae=sum(algae==1),\n             Nnonvascular=sum(nonvascular==1),\n             Nfungi=sum(fungi==1),\n             Ndiatoms=sum(diatoms==1),\n             Nmicrobemix=sum(microbemix==1))\nsumm.SI.subgroup2.melted<- melt(summ.SI.subgroup2, id=c('sys1')) \nsetnames(summ.SI.subgroup2.melted, 'value','numStudiesPresent')\n\n#subgroup_labels\nsub.groupName<-rep(subgroup_labels, each=length(unique(df.subgroup$sys1)))\nsumm.SI.subgroup1<-data.frame(summ.SI.subgroup2.melted,sub.groupName)\n\n#identify the group to which each sub.group belongs\nsumm.SI.subgroup1$group.manual<-NA\n#plantGroup_labels\n#microbeGroup_labels\n#animalGroup_labels\nsumm.SI.subgroup1[summ.SI.subgroup1$sub.groupName %in% plantGroup_labels,'group.manual']<-'plants'\nsumm.SI.subgroup1[summ.SI.subgroup1$sub.groupName %in% microbeGroup_labels,'group.manual']<-'microbes'\nsumm.SI.subgroup1[summ.SI.subgroup1$sub.groupName %in% animalGroup_labels,'group.manual']<-'animals'\n\n#replace 'animals' with animal.groups\nsumm.SI.subgroup1<-summ.SI.subgroup1[summ.SI.subgroup1$group.manual !='animals',] #remove animals from current \ndf.animalgroup<-ExpandMelt(df=Study.Info.1, varName='animal.group') #count number of animal studies\n#unique(df.animalgroup$animal.group)\nsumm.SI.animalgroup <- ddply(df.animalgroup,~sys1+ID, summarise, \n              arthropods=sum(animal.group=='arthropods'),\n              birds=sum(animal.group=='birds'),\n              mammals=sum(animal.group=='mammals'),\n              fish=sum(animal.group=='fish'),\n              herps=sum(animal.group=='herps'),\n              mollusks=sum(animal.group=='mollusks'),\n              annelids=sum(animal.group=='annelids'))\nsumm.SI.animalgroup2<-ddply(summ.SI.animalgroup , ~sys1, summarize,\n             Narthropods=sum(arthropods==1),\n             Nbirds=sum(birds==1),\n             Nmammals=sum(mammals==1),\n             Nfish=sum(fish==1),\n             Nherps=sum(herps==1),\n             Nmollusks=sum(mollusks==1),\n             Nannelids=sum(annelids==1))\nsumm.SI.animalgroup2.melted<- melt(summ.SI.animalgroup2, id=c('sys1')) \nsetnames(summ.SI.animalgroup2.melted, 'value','numStudiesPresent')\n#animalSubGroup_labels\nsub.groupName<-rep(animalSubGroup_labels, each=length(unique(df.subgroup$sys1)))\nsumm.SI.animalgroup1<-data.frame(summ.SI.animalgroup2.melted,sub.groupName)\n\n#identify the vert/invert to which each animal.group belongs\nsumm.SI.animalgroup1$group.manual<-NA\n#vertGroup_labels\n#invertGroup_labels\nsumm.SI.animalgroup1[summ.SI.animalgroup1$sub.groupName %in% vertGroup_labels,'group.manual']<-'vertebrates'\nsumm.SI.animalgroup1[summ.SI.animalgroup1$sub.groupName %in% invertGroup_labels,'group.manual']<-'invertebrates'\n\n#merge summ.subgroup and summ.animalgroup\n#colnames(summ.subgroup); colnames(summ.animalgroup)\nsumm.group<-rbind(summ.SI.subgroup1, summ.SI.animalgroup1)\n#group.manual_labels\nsumm.group$group.manual<-factor(summ.group$group.manual, levels = group.manual_labels)\nsumm.group.o<-orderBy(~group.manual-numStudiesPresent,summ.group)\npositionsGRP<-list(plants=plantGroup_labels.o,\n                   inverts=invertGroup_labels.o,\n                   verts=vertGroup_labels.o,\n                   microbes=microbeGroup_labels.o)\n\n#plot\nGRP<-unique(summ.group.o$group.manual)\nPlots.group<-list()\ni<-0\nfor(i in 1:length(GRP)){\n  sub.df<-subset(summ.group.o, group.manual==GRP[i])\n  positions<-positionsGRP[[i]]\n  Plots.group[[i]]<-ggplot(sub.df, aes(x=sub.groupName, \n                                          y=numStudiesPresent, \n                                          fill=sys1)) + \n    geom_bar(stat='identity') + \n    ylab('# of studies') + xlab('') +\n    scale_y_continuous(expand=c(0,0)) + scale_x_discrete(limits= positions) +\n    scale_fill_manual(name='System',\n                    labels=c('Aquatic','Terrestrial','Both'),\n                    values=c('#1F497D','#008000','#D72027')) +\n    guides(fill=FALSE)+\n    theme_bw() + theme(axis.text.x = element_text(angle=45, hjust=1))\n}\nnames(Plots.group)<-GRP\n\nPlot.plants<-Plots.group[['plants']]+ggtitle('Plants')+scale_y_continuous(expand=c(0,0), limits=c(0,65))\nPlot.microbes<-Plots.group[['microbes']]+ggtitle('Microbes')+scale_y_continuous(expand=c(0,0), limits=c(0,2.1))\nPlot.inverts<-Plots.group[['invertebrates']]+ggtitle('Invertebrates')+scale_y_continuous(expand=c(0,0), limits=c(0,18))\nPlot.verts<-Plots.group[['vertebrates']]+ggtitle('Vertebrates')+scale_y_continuous(expand=c(0,0), limits=c(0,12))\n```\nAmong plants, understory plant groups such as forbs and grasses are most commonly studied. Among vertebrates, fish are the most commonly studied taxa, followed by birds.   \n```{r Q1_taxa_plots,echo=FALSE, warning=FALSE, message=FALSE}\n#Plot.plants\n#Plot.verts\n```   \n\n\n\n# What are the different ways that FD has been measured?\n\n## Number of species\n```{r Q2_numSpp_1, echo=FALSE, warning=FALSE}\n#prep column\nStudy.Info.1$Total.Number.Species<-as.character(Study.Info.1$Total.Number.Species)\nStudy.Info.1$Total.Number.Species<-as.numeric(Study.Info.1$Total.Number.Species) #ok - these \n#order data and remove outliers\ndf.o<-orderBy(~-Total.Number.Species, Study.Info.1)\noutliers<-df.o[1:2,'Total.Number.Species'] #there are 2 crazy outliers with >1000 species\nnumSp.df<-df.o[df.o$Total.Number.Species <1000 & !is.na(df.o$Total.Number.Species),]\n#calc medians\nsumm.SI.numSp.sys1Grp <- ddply(numSp.df,~sys1Grp, summarise,\n                    n=length(unique(ID)),\n                    med=median(Total.Number.Species, na.rm=T),\n                    min=min(Total.Number.Species, na.rm=T),\n                    max=max(Total.Number.Species, na.rm=T))\n#summ.SI.numSp.sys1Grp\nmedianSp<-median(numSp.df$Total.Number.Species, na.rm = T)\npaste('Median =', medianSp)\n\n#hist colored by system and taxa\nnumSp.df1<-subset(numSp.df, sys1Grp != 'other')\nPlot.numSpecies.sys1Grp<-ggplot(numSp.df1, aes(x = Total.Number.Species, fill=sys1Grp))+\n  geom_histogram(binwidth = 30)+\n  facet_wrap(~sys1Grp, ncol=2, scales='free_y')+\n  xlab(\"Number of species\")+\n  ylab(\"Number of studies\") + theme_bw() +\n  scale_x_continuous(expand = c(0,0)) +\n  scale_y_continuous(expand = c(0,0)) +\n  scale_fill_manual(name='System and Taxa',\n                    labels=c(sys1Grp_labels),\n                    values=c(sys1Grp_colors)) +\n  geom_vline(xintercept=medianSp, col=1, linetype=2) +\n  guides(fill=FALSE)\n#Plot.numSpecies.sys1Grp\n```  \nOverall, each study looks at about `r medianSp` species (median value). There were two studies with >1000 species -- these were excluded from the calculation of the median number of species per study and the plot.\n\n## Traits\nTraits were classified into 14 trait categories that generalize ways in which a trait might describe the functioning of an organism in an ecosystem.  \n```{r Q2_traits_1,echo=FALSE, warning=FALSE}\ntrCatcode<-paste('cat', seq(1:15), sep=\"\")\ntrCatIndex<-data.frame(trCatcode, trCat=unique(Trait.Info.1$Trait.Category.New))\nsumm.TI.cat <- ddply(Trait.Info.1,~ID, summarise, \n              cat1=sum(Trait.Category.New==trCatIndex[1,'trCat']),\n              cat2=sum(Trait.Category.New==trCatIndex[2,'trCat']),\n              cat3=sum(Trait.Category.New==trCatIndex[3,'trCat']),\n              cat4=sum(Trait.Category.New==trCatIndex[4,'trCat']),\n              cat5=sum(Trait.Category.New==trCatIndex[5,'trCat']),\n              cat6=sum(Trait.Category.New==trCatIndex[6,'trCat']),\n              cat7=sum(Trait.Category.New==trCatIndex[7,'trCat']),\n              cat8=sum(Trait.Category.New==trCatIndex[8,'trCat']),\n              cat9=sum(Trait.Category.New==trCatIndex[9,'trCat']),\n              cat10=sum(Trait.Category.New==trCatIndex[10,'trCat']),\n              cat11=sum(Trait.Category.New==trCatIndex[11,'trCat']),\n              cat12=sum(Trait.Category.New==trCatIndex[12,'trCat']),\n              cat13=sum(Trait.Category.New==trCatIndex[13,'trCat']),\n              cat14=sum(Trait.Category.New==trCatIndex[14,'trCat']),\n              cat15=sum(Trait.Category.New==trCatIndex[15,'trCat'])\n              )\nsumm.TI.cat1<-melt(summ.TI.cat, id.vars = 'ID')\nsetnames(summ.TI.cat1, 'variable','trCatcode')\nsetnames(summ.TI.cat1, 'value','numTr')\nsumm.TI.cat1$catPresent<-summ.TI.cat1$numTr !=0\nsumm.TI.cat2<-merge(summ.TI.cat1, trCatIndex, by='trCatcode')\nsumm.TI.cat3<-ddply(summ.TI.cat2, ~trCat, summarize, nID=length(catPresent[catPresent=='TRUE']))\nsumm.TI.cat3.o<-orderBy(~-nID, summ.TI.cat3)\npositions<-summ.TI.cat3.o$trCat\n\n#plot\nPlot.traitCat<-ggplot(summ.TI.cat3.o, aes(x=trCat, y=nID)) + \n  geom_bar(stat='identity') + \n  ylab('Number of studies') + xlab('Trait category') +\n  scale_y_continuous(expand=c(0,0)) + scale_x_discrete(limits= positions) + \n  theme_bw() + theme(axis.text.x = element_text(angle=45, hjust=1))\nPlot.traitCat\n\n\n#by sys1Grp\nsumm.TI.cat2.1<-merge(summ.TI.cat2, id_sys1Grp)\nsumm.TI.cat3.1<-ddply(summ.TI.cat2.1, ~sys1Grp+trCat, summarize,\n             nID=length(catPresent[catPresent=='TRUE']))\nsumm.TI.cat3.1.o<-orderBy(~sys1Grp-nID, summ.TI.cat3.1)\nsumm.TI.cat3.1.o$trCat<-factor(summ.TI.cat3.1.o$trCat, levels=positions)\n\n#plot\nPlot.traitCat.sys1Grp<-ggplot(summ.TI.cat3.1.o, aes(x=trCat, y=nID, fill=sys1Grp)) + \n  geom_bar(stat='identity') +\n  ylab('Number of studies') + xlab('Trait category') +\n  scale_y_continuous(expand=c(0,0)) +theme_bw() + \n  theme(axis.text.x = element_text(angle=45, hjust=1)) +\n  scale_fill_manual(name='System and Taxa',\n                    labels=c(sys1Grp_labels),\n                    values=c(sys1Grp_colors))\n#Plot.traitCat.sys1Grp\n\n#plot in facets\nsumm.TI.cat3.1.o.1<-subset(summ.TI.cat3.1.o, sys1Grp != 'other')\nPlot.traitCat.sys1Grp2<-ggplot(summ.TI.cat3.1.o.1, aes(x=trCat, y=nID, fill=sys1Grp)) + \n  geom_bar(stat='identity') + facet_wrap(~sys1Grp, ncol=2, scale='free_y')+\n  ylab('# of studies') + xlab('Trait category') +\n  scale_y_continuous(expand=c(0,0)) + theme_bw() + \n  theme(axis.text.x = element_text(angle=45, hjust=1)) +\n  scale_fill_manual(name='System and Taxa',\n                    labels=c(sys1Grp_labels),\n                    values=c(sys1Grp_colors)) +\n  guides(fill=FALSE)\nPlot.traitCat.sys1Grp2\n\n### which traits were classified as 'resource allocation' for terrestrial plants?\nTrait.Info.1.tp<-subset(Trait.Info.1, sys1Grp==\"terrestrial plants\" & Trait.Category.New == \"resource use\")\nunique(Trait.Info.1.tp$Trait.Name)\n```  \nThe top five trait categories that are represented in this dataset are (1) body size, (2) growth allocation, (3) resource use, (4) reproduction, and (5) temporal partioning.\n\n```{r Q2_traits_2,echo=FALSE, warning=FALSE}\nsumm.TI.tr <- ddply(Trait.Info.1,~Trait.Category.New+Trait.Name, summarise, \n              nID=length(unique(ID)))\nsumm.TI.tr.o<-orderBy(~-nID, summ.TI.tr)\nsumm.TI.tr.o1<-summ.TI.tr.o[summ.TI.tr.o$nID >= 5,] #only include traits that show up in 5 or more studies\n\n#plot\nCAT<-unique(summ.TI.tr.o1$Trait.Category.New)\nPlots.trait<-list()\ni<-0\nfor(i in 1:length(CAT)){\n  tmp.df<-subset(summ.TI.tr.o1, Trait.Category.New == CAT[i])\n  positions<-tmp.df$Trait.Name\n  Plots.trait[[i]]<-ggplot(tmp.df, aes(x=Trait.Name, y=nID)) + geom_bar(stat='identity') + \n    ylab('Number of studies') + xlab('Trait name') +\n    scale_y_continuous(expand=c(0,0)) + scale_x_discrete(limits= positions) + \n    theme_bw() + theme(axis.text.x = element_text(angle=45, hjust=1)) + ggtitle(CAT[i])\n}\nnames(Plots.trait)<-CAT\n\n#Plots.trait[['growth allocation']] + ggtitle('Growth allocation')\n#Plots.trait[['body size']] + ggtitle('Body size')\nPlots.trait[['resource use']] + ggtitle('Resource use')\n#Plots.trait[['reproduction']] + ggtitle('Reproduction')\n#Plots.trait[['temporal partitioning']]\n#Plots.trait[['unclassified']]\n\n#habitat trait examples\njustHabitat<-summ.TI.tr[summ.TI.tr$Trait.Category.New=='habitat',]\njustHabitat.o<-orderBy(~-nID, justHabitat)\njustHabitat.o[1:10,'Trait.Name']\n``` \nCharacteristic traits within each trait category include...\n(1) body size: height, body size, max height, canopy height, body length\n(2) growth allocation: specific leaf area, leaf dry matter content, leaf size, wood density\n(3) resource use: diet, foraging method, foraging substrate, N fixation, root type\n(4) reproduction: seed mass, clonality, reproduction mode, pollen vector, flowering period\n\nNote: These plots only include traits that show up in 5 or more studies.\n\n```{r Q2_traits_3,echo=FALSE, warning=FALSE}\n#how many traits?\nsumm.TI.numTr <- ddply(Trait.Info.1,~ID, summarise, \n              nTrait=length(unique(Trait.Name)),\n              nTraitCat=length(unique(Trait.Category.New)))\nsumm.TI.numTr1<-merge(summ.TI.numTr, id_sys1Grp, by=\"ID\")\n\n#plot\nmedianTr<-median(summ.TI.numTr1$nTrait, na.rm=T)\nnumTraits.sys1Grp<-ddply(summ.TI.numTr1, ~sys1Grp, summarize, \n                         mean=mean(nTrait, na.rm=T),\n                         med=median(nTrait, na.rm=T),\n                         min=min(nTrait, na.rm=T),\n                         max=max(nTrait, na.rm=T))\n\n#classify by just A/T\nsumm.TI.numTr1$aquatic<-\"no\"\nsumm.TI.numTr1[grepl(\"aquatic\", summ.TI.numTr1$sys1Grp),\"aquatic\"]<-\"yes\"\nsumm.TI.numTr1$terrestrial<-\"no\"\nsumm.TI.numTr1[grepl(\"terrestrial\", summ.TI.numTr1$sys1Grp),\"terrestrial\"]<-\"yes\"\n\nnumTraits.A<-ddply(summ.TI.numTr1, ~aquatic, summarize, \n                         mean=mean(nTrait, na.rm=T),\n                         med=median(nTrait, na.rm=T),\n                         min=min(nTrait, na.rm=T),\n                         max=max(nTrait, na.rm=T))\nnumTraits.T<-ddply(summ.TI.numTr1, ~terrestrial, summarize, \n                         mean=mean(nTrait, na.rm=T),\n                         med=median(nTrait, na.rm=T),\n                         min=min(nTrait, na.rm=T),\n                         max=max(nTrait, na.rm=T))\n\n\nnumTraits.sys1Grp\npaste('Median =',medianTr)\nsumm.TI.numTr1.1<-subset(summ.TI.numTr1, sys1Grp != 'other')\nPlot.numTraits.sys1Grp<-ggplot(summ.TI.numTr1.1, aes(x =nTrait, fill=sys1Grp))+\n  geom_histogram(binwidth=1)+xlab(\"Number of traits\")+ \n  facet_wrap(~sys1Grp, ncol=2, scales='free_y') +\n  scale_x_continuous(expand = c(0,0), limits=c(1,50), breaks=c(0,2,5,7,10, 20, 30, 40, 50)) +\n  scale_y_continuous(expand = c(0,0)) +\n  ylab(\"Number of studies\")+ theme_bw() +\n  geom_vline(xintercept=medianTr, col=1, linetype=2)+\n  scale_fill_manual(name='System and Taxa',\n                    labels=c(sys1Grp_labels),\n                    values=c(sys1Grp_colors)) +\n  guides(fill=FALSE)\n#Plot.numTraits.sys1Grp\n\n\n#how many trait categories?\nmedianTrCat<-median(summ.TI.numTr$nTraitCat, na.rm=T)\nnumTrCat.sys1Grp<-ddply(summ.TI.numTr1, ~sys1Grp, summarize, \n                        mean=mean(nTraitCat, na.rm=T),\n                         med=median(nTraitCat, na.rm=T),\n                         min=min(nTraitCat, na.rm=T),\n                         max=max(nTraitCat, na.rm=T))\nnumTrCat.sys1Grp\nPlot.numTraitCats<-ggplot(summ.TI.numTr, aes(x =nTraitCat))+\n  geom_histogram(binwidth=1)+xlab(\"Number of trait categories\")+\n  scale_x_continuous(expand = c(0,0), breaks=c(1:10), limits=c(1,11)) +\n  scale_y_continuous(expand = c(0,0)) +\n  ylab(\"Number of studies\") + theme_bw() +\n  geom_vline(xintercept=medianTrCat, col=1, linetype=2)\n#Plot.numTraitCats\npaste('Median =',medianTrCat)\n\n```  \nTypically, studies include `r medianTr` traits and `r medianTrCat` trait categories (median values).\n\n\n\n## Trait sources\n```{r Q2_source_1,echo=FALSE, warning=FALSE}\ndf.trsource<-ExpandMelt(df=Trait.Info.1, varName='Trait.Source')\nsumm.TI.trSource <- ddply(df.trsource,~ID, summarise, \n              nSources=length(unique(Trait.Source)),\n              nameSource=paste(unique(Trait.Source),collapse=\"_\"),\n              nMeas=length(unique(Trait.Source[Trait.Source==1])),\n              nDatab=length(unique(Trait.Source[Trait.Source==2])),\n              nLit=length(unique(Trait.Source[Trait.Source==3])))\nsumm.TI.trSource1<-summ.TI.trSource[,c('ID','nMeas','nDatab','nLit')]\nsumm.TI.trSource1m<-melt(summ.TI.trSource1, id.vars='ID')\nsumm.TI.trSource2 <- ddply(summ.TI.trSource1m,~variable, summarise, nID=length(value[value==1]))\nsumm.TI.trSource2$Trait.Source_labels<-Trait.Source_labels\nsumm.TI.trSource2.o<-orderBy(~-nID, summ.TI.trSource2)\npositions<-summ.TI.trSource2.o$Trait.Source_labels\n\n#plot\nPlot.trsource<-ggplot(summ.TI.trSource2.o, aes(x=Trait.Source_labels, y=nID)) + \n  geom_bar(stat='identity') + \n  ylab('Number of studies') + xlab('Trait source') +\n  scale_y_continuous(expand=c(0,0), limits=c(0,100)) + scale_x_discrete(limits= positions) + \n  theme_bw() + theme(axis.text.x = element_text(angle=45, hjust=1))\n#Plot.trsource\n\n#What % of studies measure (at least some) of their own traits?\n#What % of studies use trait databases?\nnumStudies<-length(summ.TI.trSource$ID)\nnMeas<-summ.TI.trSource2.o[summ.TI.trSource2.o$variable=='nMeas', 'nID']\nnDatab<-summ.TI.trSource2.o[summ.TI.trSource2.o$variable=='nDatab', 'nID']\npercMeas<-round((nMeas/numStudies)*100, digits=0)\npercDatab<-round((nDatab/numStudies)*100, digits=0) \npaste(percMeas,'% of studies that measure traits')\n#paste(percDatab,'% of studies that use a trait database')\n```  \nMost studies (`r percMeas`%) measure at least some of their own traits. The next most common trait sources are from literature and trait databases. Only `r percDatab`% of studies use trait database data.\n\n```{r Q2_source_2,echo=FALSE, warning=FALSE}\n#What % of studies use >1 trait source?\nsumm.TI.numTrSource<-summ.TI.trSource[,c('ID','nSources','nameSource')]\nsumm.TI.numTrSource.sys1Grp<-merge(summ.TI.numTrSource, id_sys1Grp, by=\"ID\") #used to be called 'summ1'\ntotal<-length(summ.TI.numTrSource$nSources)\nselection<-sum(summ.TI.numTrSource$nSources > 1)\nperc_1TrS<-round((selection/total)*100, digits=2)\npaste(perc_1TrS,'% of studies use more than 1 trait source')\n\n#Of the studies that only use 1 source, what source is most common?\nsumm.TI.numTrSource.1trS<-summ.TI.numTrSource[summ.TI.numTrSource$nSources==1,]\nsumm.TI.numTrSource.1trS1<-ddply(summ.TI.numTrSource.1trS, ~nameSource, summarize, numSource=length(unique(ID)))\nnumStudies1<-sum(summ.TI.numTrSource$nSources == 1)\nnMeas<-summ.TI.numTrSource.1trS1[summ.TI.numTrSource.1trS1$nameSource=='1','numSource']\nnDatab<-summ.TI.numTrSource.1trS1[summ.TI.numTrSource.1trS1$nameSource=='3','numSource']\npercMeas<-round((nMeas/numStudies1)*100, digits=0)\npercDatab<-round((nDatab/numStudies1)*100, digits=0) \npaste(percMeas,'% of studies that use 1 trait souce measure their own traits')\npaste(percDatab,'% of studies that use 1 trait souce use a trait database')\n```  \nOnly `r perc_1TrS`% of studies use >1 trait source. Of the studies that use only 1 trait source, `r percMeas`% measure their own traits and `r percDatab`% use trait databases.\n\n```{r Q2_source_3,echo=FALSE, warning=FALSE}\n#Have the use of trait sources changed over time?\nsumm.TI.trSource.yr <- ddply(df.trsource,~year+Trait.Source, summarise, nID=length(unique(ID))) \nsumm.TI.trSource.yr<-merge(summ.TI.trSource.yr, trSourceIndex, by='Trait.Source')\nsumm.TI.trSource.yr.o<-orderBy(~year+Trait.Source, summ.TI.trSource.yr)\n\nsumm.TI.trSource.yr.wide<-dcast(summ.TI.trSource.yr.o, year~Trait.Source+trSourceName, value.var = 'nID')\nsumm.TI.trSource.yr.wide$nID<-apply(summ.TI.trSource.yr.wide[,-1], 1, sum, na.rm=T)\nsumm.TI.trSource.yr.wide$percMeas<-(summ.TI.trSource.yr.wide[,'1_Measurement']/summ.TI.trSource.yr.wide$nID)*100\nsumm.TI.trSource.yr.wide$percDatab<-(summ.TI.trSource.yr.wide[,'2_Trait database']/summ.TI.trSource.yr.wide$nID)*100\nsumm.TI.trSource.yr.wide.s<-subset(summ.TI.trSource.yr.wide, nID >2) #get rid of year/sources with less than 2 observations\nsumm.TI.trSource.yr1<-summ.TI.trSource.yr.wide.s[,c('year','percMeas','percDatab')]\nsumm.TI.trSource.yr1.long<-melt(summ.TI.trSource.yr1, measure.vars = c('percMeas','percDatab'))\n\n#plot\nPlot.trsource.yr<-ggplot(summ.TI.trSource.yr1.long, aes(x=year, y=value, fill=variable)) + \n  geom_bar(stat='identity', position='dodge') + \n  ylab('Percent (%) of studies') + xlab('Year') +\n  scale_y_continuous(expand=c(0,0), limits=c(0,70)) +\n  scale_x_continuous(limits=c(2005,2015), breaks=c(2006, 2008, 2010, 2012, 2014)) +\n  theme_bw() + theme(axis.text.x = element_text(angle=45, hjust=1)) +\n  scale_fill_manual(name='Trait source',\n                    labels=trsource.yr_fill_labels,\n                    values=trsource.yr_fill_colors)\nPlot.trsource.yr\n```  \nAlthough there has been a recent push to contribute to trait databases, there does not appear to be a rise in the use of trait databases in the current literature.  Studies continue to rely primarily on their own trait measurements. Note: To make this figure, I removed year x trait source categories with less than 2 observations because a percentage made up of less than 2 observations is pretty silly.\n\n\n## FD metrics\n```{r Q2_metric_1,echo=FALSE, warning=FALSE}\n#First, need to summarize data by ID and FD metric \n\n#by ID\ntotCode<-length(unique(Metric.Info.1$code))\nunique(Metric.Info.1$code)\ntotalNumMetrics<-length(unique(Metric.Info.1$code))\ntotDim<-length(unique(Metric.Info.1$CAT_dimension))\ntotMeth<-length(unique(Metric.Info.1$CAT_multivarMethod))\nsumm.MI<-ddply(Metric.Info.1, ~ID, summarize,\n               nCode=length(unique(code)),\n               nDim=length(unique(CAT_dimension)),\n               nMeth=length(unique(CAT_multivarMethod)))\nsumm.MI<-merge(summ.MI, id_sys1Grp, by=\"ID\")\n\n#by code\nsumm.MI.code <- ddply(Metric.Info.1,~code, summarise, \n                   nID=length(unique(ID)), \n                   Dim=unique(CAT_dimension), \n                   Meth=unique(CAT_multivarMethod), \n                   Abund=unique(CAT_abundance),\n                   minYear = min(year, na.rm=T))\nsumm.MI.code.o<-orderBy(~-nID, summ.MI.code)\nsumm.MI.code.o1<-summ.MI.code.o[which(summ.MI.code.o$nID >9),]\nsumm.MI.code.o1\n\n#by code, by sys1Grp\nsumm.MI.code.sys1Grp <- ddply(Metric.Info.1,~code+sys1Grp, summarise, \n                   nID=length(unique(ID)), \n                   Dim=unique(CAT_dimension), \n                   Meth=unique(CAT_multivarMethod), \n                   Abund=unique(CAT_abundance),\n                   minYear = min(year, na.rm=T))\nGROUP<-unique(summ.MI.code.sys1Grp$sys1Grp)\ntopFDmetrics<-list()\ni<-0\nfor(i in 1:length(GROUP)){\n  summ.grp<-summ.MI.code.sys1Grp[summ.MI.code.sys1Grp$sys1Grp == GROUP[i],]\n  summ.grp.o<-orderBy(~-nID, summ.grp)\n  topFDmetrics[[i]]<-summ.grp.o[1:6,]\n}\nnames(topFDmetrics)<-GROUP\ntopFDmetrics.sys1Grp<-ldply(topFDmetrics)\n\n#What % of studies use at least 1 of the top 6 FD metrics\nMetric.Info.1$top6present<-'no' #mark the row if it has a Top6 code\nMetric.Info.1[Metric.Info.1$code %in% c('Rao','FRic','FEve','FDis','FDiv', 'FD'),'top6present']<-'yes'\nsumm.MI.codePresence<-ddply(Metric.Info.1, ~ID, summarize, #summarize by ID\n               nCodes=length(unique(code)),\n               nameCodes=paste(unique(code), collapse='_'),\n               nTop6=length(top6present[top6present=='yes']),\n               presTop6=nTop6!=0,\n               nRao=length(code[code=='Rao']),\n               nFRic=length(code[code=='FRic']),\n               nFEve=length(code[code=='FEve']),\n               nFDis=length(code[code=='FDis']),\n               nFDiv=length(code[code=='FDiv']),\n               nFD=length(code[code=='FD']))\nselection<-sum(summ.MI.codePresence$presTop6 == TRUE) #count the number of IDs\ntotalNumStudies<-length(summ.MI.codePresence$presTop6) #count the number of IDs\ntotalNumStudies\npercTop6<-round((selection/totalNumStudies)*100, digits=2)\npaste(percTop6,'% of studies use at least 1 of the top 6 metrics')\n\n#What % of studies use each of the top 6 FD metrics?\nTOP6<-c('nRao','nFRic','nFEve','nFDis','nFDiv','nFD')\nstore<-list()\ni<-0\nfor(i in 1:length(TOP6)){\n  selection<-sum(summ.MI.codePresence[,TOP6[i]]) #count the number of ID\n  perc<-round((selection/totalNumStudies)*100, digits=0)\n  store[[i]]<-paste(perc,'% of studies use', TOP6[i])\n}\nstore\n\n```  \nThe total number of metrics identified is `r totalNumMetrics`\n\nThe majority of studies (`r percTop6`%) use a least 1 FD metric from the top 6 metrics. \n- `r store[[1]]`\n- `r store[[2]]`\n- `r store[[3]]`\n- `r store[[4]]`\n- `r store[[5]]`\n- `r store[[6]]`\n\nThere have been a number of metrics that have been proposed in the past couple of years, but we don't know yet whether their use will spread.  Some of the first-appearing metrics continue to dominate the current literature, i.e. FD, FRic.   \n```{r Q2_metric_2,echo=FALSE, warning=FALSE}\n#What is the relationship between the frequency each metric is used and its appearance in the literature?\nPlot.codeFreq<-ggplot(data=summ.MI.code.o) +\n  geom_point(aes(x=minYear, y=nID)) +\n  geom_text(aes(x=minYear, y=nID, label=ifelse(nID>9, as.character(code),'')), hjust=-0.2, vjust=0) +\n  scale_x_continuous(limits=c(2005,2015), breaks=c(2006, 2008, 2010, 2012, 2014)) +\n  theme_bw()+\n  theme(axis.text.x = element_text(angle=45, hjust=1)) +\n  ylab('Number of studies') + xlab('1st year the metric was observed')\nPlot.codeFreq\n```     \n\n```{r Q2_metric_3,echo=FALSE, warning=FALSE}\n#How many metrics per study?\nPlot.numFDcodes<-ggplot(summ.MI, aes(x =nCode)) +\n  geom_histogram(binwidth=1) +\n  xlab(\"Number of metrics\") +\n  scale_x_continuous(expand = c(0,0), breaks=0:10, limits=c(0,10)) +\n  scale_y_continuous(expand = c(0,0)) +\n  ylab(\"Number of studies\") + theme_bw() \n#Plot.numFDcodes\nnumFDmetrics<-median(summ.MI$nCode)\nnumFDmetrics\nmax(summ.MI$nCode)\nmean(summ.MI$nCode)\n\n#What % of studies use only 1 diversity metric?\nselection<-length(which(summ.MI$nCode == 1))\nselection\ntotal<-length(unique(summ.MI$ID))\ntotal\nanswer<-round((selection/total)*100, digits=0)\npaste(answer, '% of studies use only 1 functional diversity metric')\npaste(100-answer, '% of studies use >1 functional diversity metric')\n\n#Of studies that use only 1 diversity metric, what is it?\nonly1IDs<-summ.MI[summ.MI$nCode == 1,'ID']\ndf.only1IDs<-Metric.Info.1[Metric.Info.1$ID %in% only1IDs,]\nsumm.MI.only1 <- ddply(df.only1IDs,~code, summarise, nID=length(unique(ID)))\nsumm.MI.only1.o<-orderBy(~-nID, summ.MI.only1)\ntotal<-sum(summ.MI.only1.o$nID)\nrao<-summ.MI.only1.o[1,'nID']\nanswer2<-round(((rao)/total)*100, digits=0)\nrao\ntotal\npaste('Of the studies that use only 1 FD metric,', answer2, '% use Rao')\n```  \nEach study typically includes `r numFDmetrics` FD metrics (median value). `r 100-answer`% of studies use more than 1 FD metric.  Of the studies that use only one FD metric, the majority (`r answer2`%) use Rao.\n\n\n\n## Diversity dimensions\n```{r Q2_dim_1,echo=FALSE, warning=FALSE}\nsumm.MI.dim <- ddply(Metric.Info.1,~CAT_dimension, summarise, nID=length(unique(ID)))\nsumm.MI.dim.o<-orderBy(~-nID, summ.MI.dim )\npositions<-summ.MI.dim.o$CAT_dimension\n\n#plot\nPlot.dim<-ggplot(summ.MI.dim.o, aes(x=CAT_dimension, y=nID)) + \n  geom_bar(stat='identity') + \n  ylab('Number of studies') + xlab('Functional diversity dimension') +\n  scale_y_continuous(expand=c(0,0), limits=c(0,120)) + scale_x_discrete(limits= positions) +\n  theme_bw() + theme(axis.text.x = element_text(angle=45, hjust=1))\nPlot.dim\n\n#How many diversity dimensions per study?\nPlot.numDim<-ggplot(summ.MI, aes(x =nDim)) +\n  geom_histogram(binwidth=1)+xlab(\"Number of diversity dimensions\") +\n  ylab(\"Number of studies\") + theme_bw() +\n  scale_x_continuous(expand = c(0,0), breaks=0:5, limits=c(0,5)) +\n  scale_y_continuous(expand = c(0,0))\nPlot.numDim\n\n#What % of studies use only 1 diversity dimension?\nselection<-length(which(summ.MI$nDim == 1))\nselection\ntotal<-length(unique(summ.MI$ID))\ntotal\nanswer<-round((selection/total)*100, digits=0)\npaste(answer, '% of studies use only 1 dimension of functional diversity, e.g. divergence, richness, etc.')\npaste(100-answer, '% of studies use >1 dimension of functional diversity, e.g. divergence, richness, etc.')\n\n#Of studies that use only 1 diversity dimension, what is it? \nonly1dim<-summ.MI[summ.MI$nDim == 1,'ID']\ndf.only1dim<-Metric.Info.1[Metric.Info.1$ID %in% only1dim,]\nsumm.MI.only1dim <- ddply(df.only1dim,~CAT_dimension, summarise, nID=length(unique(ID)))\nsumm.MI.only1dim.o<-orderBy(~-nID, summ.MI.only1dim)\ntotal<-sum(summ.MI.only1dim.o$nID)\ntotal\ndiverg<-summ.MI.only1dim.o[1,'nID']\nanswer2<-round(((diverg)/total)*100, digits=0)\npaste('Of the studies that use only 1 FD dimension,', answer2, '% use divergence')\n\n#Of the studies that use >1 metric, what % look at >1 diversity dimension? \nselection<-length(which(summ.MI$nCode > 1 & summ.MI$nDim > 1))\ntotal<-length(which(summ.MI$nCode > 1))\nanswer3<-round((selection/total)*100, digits=0)\npaste(answer3, '% of studies that use >1 FD metric use >1 FD dimension, e.g. divergence, richness, etc.')\ntotal\nselection\nlength(which(summ.MI$nDim == 4))\n```  \nThe majority of studies include FD metrics that examine functional divergence, followed in order by richness, eveness, and redundancy. Most studies look at just 1 dimension of diversity (`r answer`%), e.g. divergence, richness, etc. However, `r answer3`% of studies that use more than one FD metric, look at more than one dimension of diveristy.  Of the studies that look at only one dimension of diversity, `r answer2`% look at divergence.\n\n```{r Q2_dim_2,echo=FALSE, warning=FALSE}\nsumm.MI.abund <- ddply(Metric.Info.1, ~ID, summarise,\n                       nAbund=length(CAT_abundance[CAT_abundance=='yes']),\n                       nAbund.n=length(CAT_abundance[CAT_abundance=='no']),\n                       nMetrics=length(unique(code)),\n                       total=nAbund+nAbund.n)\nsumm.MI.abund$abundPresent<-summ.MI.abund$nAbund>0\n\nselection<-sum(summ.MI.abund$abundPresent==TRUE)\ntotal<-dim(summ.MI.abund)[1]\nanswer<-round((selection/total)*100, digits=0)\npaste(answer, '% of studies incorporate abundance into at least 1 of their functional diversity metrics')\n```\nLast, `r answer`% of studies incorporate species abundance into at least 1 FD metric.\n\n\n\n## Multivariate method\n```{r Q2_mm_1,echo=FALSE, warning=FALSE}\nsumm.MI.meth <- ddply(Metric.Info.1,~CAT_multivarMethod, summarise, nID=length(unique(ID)))\nsumm.MI.meth.o<-orderBy(~-nID, summ.MI.meth)\npositions<-summ.MI.meth.o$CAT_multivarMethod\n\n#plot\nPlot.meth<-ggplot(summ.MI.meth.o, aes(x=CAT_multivarMethod, y=nID)) + \n  geom_bar(stat='identity') + \n  ylab('Number of studies') + xlab('Multivariate method') +\n  scale_y_continuous(expand=c(0,0), limits=c(0,85)) + scale_x_discrete(limits= positions) +\n  theme_bw() + theme(axis.text.x = element_text(angle=45, hjust=1))\n#Plot.meth\n\n#How many different multivariate methods per study?\nPlot.numMeth<-ggplot(summ.MI, aes(x =nMeth)) +\n  geom_bar() + xlab(\"Number of method types\") +\n  ylab(\"Number of studies\") + theme_bw() +\n  scale_x_continuous(expand = c(0,0), breaks=0:4, limits=c(0,4)) +\n  scale_y_continuous(expand = c(0,0))\n#Plot.numMeth\n\n#What % of studies use only 1 multivariate method?\nselection<-length(which(summ.MI$nMeth == 1))\ntotal<-length(unique(summ.MI$ID))\nanswer<-round((selection/total)*100, digits=0)\npaste(answer, '% of studies use only 1 multivariate method to calculate functional diversity, e.g. ordinate, cluster, other')\n#paste(100-answer, '% of studies use >1 multivariate method to calculate functional diversity, e.g. ordinate, cluster, other')\n\n#Of the studies that use >1 metric, what % look at >1 multivariate method?  \nselection<-length(which(summ.MI$nCode > 1 & summ.MI$nMeth > 1))\ntotal<-length(which(summ.MI$nCode > 1))\nanswer2<-round((selection/total)*100, digits=0)\npaste(answer2, '% of studies that use >1 FD metric, use >1 multivariate method for calculating functional diversity, e.g. ordinate, cluster, other')\nselection\ntotal\n\n#Of the studies that use only 1 multivariate method, what is it?\nonly1meth<-summ.MI[summ.MI$nMeth == 1,'ID']\ndf.only1meth<-Metric.Info.1[Metric.Info.1$ID %in% only1meth,]\nsumm.MI.only1meth <- ddply(df.only1meth,~CAT_multivarMethod, summarise, nID=length(unique(ID)))\nsumm.MI.only1meth.o<-orderBy(~-nID, summ.MI.only1meth)\ntotal<-sum(summ.MI.only1meth.o$nID)\nordin<-summ.MI.only1meth.o[1,'nID']\nanswer3<-round(((ordin)/total)*100, digits=0)\npaste('Of the studies that use only 1 FD method,', answer3, '% use ordination')\n\ndist<-summ.MI.only1meth.o[2,'nID']\nanswer4<-round(((dist)/total)*100, digits=0)\npaste('Of the studies that use only 1 FD method,', answer4, '% use distance')\n\nclust<-summ.MI.only1meth.o[3,'nID']\nanswer5<-round((clust/total)*100, digits=0)\npaste('Of the studies that use only 1 FD method,', answer5, '% use clustering')\n\n\n```  \nThe majority of studies use FD metrics that rely on ordination, followed by distance-only and cluster based methods. Most studies use only 1 multivariate method per study. Of the studies that present more than one FD metric, `r 100-answer2`% use more than one multivariate method. Of the studies that use only one multivariate method (`r answer`), `r answer3`% use ordination. \n\n\n\n# Are there systematic differences in characterizing FD depending on the focal ecosystem or taxa? What are they? \n\n## Number of species\n```{r Q3_numSpp_1, echo=FALSE, warning=FALSE}\nsumm.SI.numSp.sys1Grp\nPlot.numSpecies.sys1Grp\n```\n\n## Number of traits\n```{r Q3_numTraits_1,echo=FALSE, warning=FALSE}\nnumTraits.sys1Grp\nnumTraits.A\nnumTraits.T\nPlot.numTraits.sys1Grp\n```  \n\n## Trait categories\n```{r Q3_traits_1,echo=FALSE, warning=FALSE}\nPlot.traitCat.sys1Grp\nPlot.traitCat.sys1Grp2\nnumTrCat.sys1Grp\n```  \n\n## FD metrics\n```{r Q3_metrics_1,echo=FALSE, warning=FALSE}\nPlot.FD.sys1Grp<-ggplot(topFDmetrics.sys1Grp, aes(x=code, y=nID)) + \n  geom_bar(stat='identity') + \n  facet_wrap(~sys1Grp, scales ='free') +\n  ylab('Number of studies') + xlab('FD metric') +\n  theme_bw() + theme(axis.text.x = element_text(angle=45, hjust=1))\nPlot.FD.sys1Grp\n```  \n\n\n\n\n\n\n\n\n\n\n\n\n",
    "created" : 1482212526888.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "116304214",
    "id" : "E654E21D",
    "lastKnownWriteTime" : 1485799126,
    "last_content_update" : 1485799147999,
    "path" : "~/Repos/fxnlDiv-OSS14/results.Rmd",
    "project_path" : "results.Rmd",
    "properties" : {
        "chunk_output_type" : "console",
        "content_preview_enabled" : "false",
        "content_preview_inline" : "false",
        "last_setup_crc32" : "4C1932098cc44832"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}